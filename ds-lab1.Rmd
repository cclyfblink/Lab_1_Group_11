---
title: "ds-lab1"
author: "Jialin Gao, Keyi Kang, Yifan Lu"
date: "2023-10-02"
output:
  html_document:
    toc: yes
    toc_depth: 2
    toc_float: yes
    fig_height: 6
    fig_width: 8
  pdf_document:
    fig_height: 3.5
    fig_width: 3.5
  word_document:
    toc: no
---
link：https://github.com/cclyfblink/Lab_1_Group_11.git

```{r,echo=FALSE}
library(medicaldata)
library(tidyverse)
library(scales)
library(ggpubr)
```

```{r}
covid <- covid_testing %>% 
  filter(test_id == "covid") %>% 
  mutate(result = str_to_title(result))
```

```{r}
covid_summary <- covid %>% 
  group_by(pan_day) %>% 
  summarise(percent_positive = sum(result == "Positive")/length(result))
```

```{r}
covid_ages <- covid %>% 
  filter(result == "Positive") %>% 
  mutate(AgeGroup = case_when(
    age >= 0  & age <= 10 ~ '0-10',
    age >= 11 & age <= 20 ~ '11-20',
    age >= 21 & age <= 30 ~ '21-30',
    age >= 31 & age <= 40 ~ '31-40',
    age >= 41 & age <= 50 ~ '41-50',
    age >= 51 & age <= 60 ~ '51-60',
    age >= 61 ~ '61+')
    )
```



### Plot B:
```{r}
# Create a bar plot using ggplot
plot_b <- ggplot(covid_summary, aes(x=pan_day, y=percent_positive)) +
  geom_bar(stat="identity", fill = "#2ca02c") +
  labs(title="Percent of Positive\n Test Results by Day",  # Add a title
       x="Pandemic Day",  # Change the x-axis label
       y="Percent Positive Tests"  # Change the y-axis label
       ) +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal() +  # Remove the gray background
  theme(plot.title = element_text(hjust = 0.5),  # Center the title
        legend.position = "none"  # Remove the legend
        )

# Print the Plot B
print(plot_b)
```


### Plot C:
```{r}
# Create a bar plot using the covid_ages dataframe
plot_c <- ggplot(covid_ages, aes(x = AgeGroup)) +
  geom_bar(fill = "#2ca02c") +  # Change bar colors to #2ca02c
  theme_minimal() +  # Remove the gray background
  theme(
    plot.title = element_text(hjust = 0.5),  # Center the title
    legend.position = "none",  # Remove the legend
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels
  ) +
  labs(
    title = "Positive Tests\n by Age Group",
    x = "Age",
    y = "Number of\nPositive Tests"
  )

# Print the Plot C
print(plot_c)
```

# Putting the plots together
```{r}
#Use ggpubr::ggarrange to arrange the plots
ggarrange(plot_a, 
          #Label the plots “A”, “B”, and “C”
          ggarrange(plot_b, plot_c, ncol = 2, labels = c("B", "C")),
          nrow = 2,
          labels = "A",
          #Create a common legend and put this at the bottom of the plot
          common.legend = TRUE,
          legend = "bottom")
```

